<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>zju.date</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content=".">
<meta property="og:url" content="https://zju.date/page/4/index.html">
<meta property="og:site_name" content=".">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content=".">
  
    <link rel="alternate" href="/atom.xml" title="." type="application/atom+xml">
  
  
    <link rel="icon" href="/css/images/banner.jpg">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">.</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">主页</a>
        
          <a class="main-nav-link" href="/archives">归档</a>
        
      </nav>
      <div id="search-form-wrap">
        
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-js-formdata" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/js-formdata/" class="article-date">
  <time datetime="2019-11-25T08:07:55.000Z" itemprop="datePublished">2019-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/js-formdata/">深入浅出 multipart/form-data</a>
    </h1>
  

      </header>
    



    <div class="article-entry" itemprop="articleBody">
      
        <div class="article-preview">
            <p>在前端开发过程中，不可避免地会遇到表单，即 <code>multipart/form-data</code>，你是否知道：</p>
<ul>
<li>HTTP 如何传输 <code>multipart/form-data</code></li>
<li>服务端如何解析 <code>multipart/form-data</code></li>
<li>浏览器如何组装 <code>multipart/form-data</code></li>
</ul>
<p>我们来看一个简单的 form 表单：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"/submit"</span> <span class="attr">method</span>=<span class="string">"POST"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"password"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>当提交的时候，查看浏览器的网络请求：</p>
<p>请求头：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST /submit HTTP/1.1</span><br><span class="line">Host: localhost:3000</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Content-Type: multipart/form-data; boundary=---------------------------340073633417401055292887335273</span><br><span class="line">Content-Length: 303</span><br></pre></td></tr></table></figure>
        </div>
        
          <p class="article-more-link">
            <a href="/js-formdata/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
     <a data-url="https://zju.date/js-formdata/" data-id="ckd1crkx30000j9se9ra1d6yq" class="article-share-link">Share</a>
     
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-feathersjs-set-expired-dynamicly" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/feathersjs-set-expired-dynamicly/" class="article-date">
  <time datetime="2019-11-25T07:38:42.000Z" itemprop="datePublished">2019-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/feathersjs-set-expired-dynamicly/">feathersjs动态设置有效期</a>
    </h1>
  

      </header>
    



    <div class="article-entry" itemprop="articleBody">
      
        <p>在 feathersjs 框架中，虽然可以在 config/default.json 设置 jwt 的有效期，但是如果想根据不同用户动态设置有效期的话，应该如何操作呢？可以通过自定义 params.jwt，加入 expiresIn 参数，这个有效期就会覆盖配置文件里面的有效期了。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">app.service(<span class="string">'authentication'</span>).hooks(&#123;</span><br><span class="line">  before: &#123;</span><br><span class="line">    create: [</span><br><span class="line">      authentication.hooks.authenticate(config.strategies),</span><br><span class="line">      context =&gt; &#123;</span><br><span class="line">        context.params.jwt = &#123; <span class="attr">expiresIn</span>: <span class="number">10</span> &#125;; <span class="comment">// 10 seconds</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    remove: [</span><br><span class="line">      authentication.hooks.authenticate(<span class="string">'jwt'</span>)</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
     <a data-url="https://zju.date/feathersjs-set-expired-dynamicly/" data-id="ckckn9o6300ckrvsea3s3e8qb" class="article-share-link">Share</a>
     
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-nestjs-notes" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/nestjs-notes/" class="article-date">
  <time datetime="2019-11-25T01:43:28.000Z" itemprop="datePublished">2019-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/nestjs-notes/">5分钟快速上手nestjs</a>
    </h1>
  

      </header>
    



    <div class="article-entry" itemprop="articleBody">
      
        <div class="article-preview">
            <p>NestJS 是一个渐进式 Node.js 框架，使用 TypeScript 编写并且结合了 OOP（面向对象编程），FP（函数式编程）和 FRP（函数式响应编程）的相关理念。NestJS 在设计上与前端框架 Angular 非常类似，与后端框架 Spring 也非常类似，学起来非常容易，5 分钟即可上手。</p>
<h1 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h1><p>安装 NestJS 命令行工具：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install -g @nestjs/cli</span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">yarn global add @nestjs/cli @nestjs/schematics</span><br></pre></td></tr></table></figure>
<p>创建新项目并启动：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nest new xxx</span><br><span class="line">yarn run start:dev <span class="comment"># 启动项目，打开 http://localhost:3000/ 会看到 hello world</span></span><br></pre></td></tr></table></figure>
        </div>
        
          <p class="article-more-link">
            <a href="/nestjs-notes/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
     <a data-url="https://zju.date/nestjs-notes/" data-id="ckckn9ofm00pdrvsey1qbkcfu" class="article-share-link">Share</a>
     
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-write-koa" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/write-koa/" class="article-date">
  <time datetime="2019-11-21T06:00:53.000Z" itemprop="datePublished">2019-11-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/write-koa/">80行代码实现Koa</a>
    </h1>
  

      </header>
    



    <div class="article-entry" itemprop="articleBody">
      
        <div class="article-preview">
            <p>Koa 是轻量级的 HTTP 框架，用法非常简单，下面 4 行代码就写了一个 hello world 的接口：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">'koa'</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line">app.use(<span class="function">(<span class="params">ctx, next</span>) =&gt;</span> ctx.body = <span class="string">'hello world'</span>)</span><br><span class="line">app.listen(<span class="number">3000</span>, () =&gt; <span class="built_in">console</span>.log(<span class="string">`server start at localhost:3000`</span>))</span><br></pre></td></tr></table></figure>
<p>接下来就实现一个简易版的 Koa，首先 Koa 是基于 Node.js 中的 http 模块和 events 模块的，基本结构如下：</p>
<ul>
<li>listen 方法监听端口</li>
<li>use 方法添加中间件</li>
<li>内部 middlewares 数组保存中间件函数</li>
</ul>
<p>接下来进行完善，核心在于 Koa 把 http 模块里面的 req 和 res 两个参数封装成了一个强大的 ctx 上下文参数，保留了原有所有 API 并扩充了自己的方法。首先要写两个对象：</p>
<ul>
<li>request 封装后的请求对象，扩充 createServer 的回调参数 req</li>
<li>response 封装后的相应对象，扩充 createServer 的回调参数 res</li>
</ul>
        </div>
        
          <p class="article-more-link">
            <a href="/write-koa/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
     <a data-url="https://zju.date/write-koa/" data-id="ckcxjsoip0002r6seg4cgppe1" class="article-share-link">Share</a>
     
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-dart-get-days-of-month" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/dart-get-days-of-month/" class="article-date">
  <time datetime="2019-11-20T15:45:59.000Z" itemprop="datePublished">2019-11-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/dart-get-days-of-month/">Dart获取指定月份的天数</a>
    </h1>
  

      </header>
    



    <div class="article-entry" itemprop="articleBody">
      
        <p>dart 获取指定月份的天数</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  <span class="built_in">DateTime</span> now = <span class="keyword">new</span> <span class="built_in">DateTime</span>.now();</span><br><span class="line">  <span class="built_in">DateTime</span> lastDayOfMonth = <span class="keyword">new</span> <span class="built_in">DateTime</span>(now.year, now.month+<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">"N days: <span class="subst">$&#123;lastDayOfMonth.day&#125;</span>"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
     <a data-url="https://zju.date/dart-get-days-of-month/" data-id="ckckn9o4c009drvseq4qt8lra" class="article-share-link">Share</a>
     
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Dart/">Dart</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-flutter-mirrors" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/flutter-mirrors/" class="article-date">
  <time datetime="2019-11-20T13:47:50.000Z" itemprop="datePublished">2019-11-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/flutter-mirrors/">flutter国内镜像地址</a>
    </h1>
  

      </header>
    



    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="https://www.awaimai.com/2835.html" target="_blank" rel="noopener">【转】</a> Flutter 官方镜像很慢，在此记录一些国内镜像地址，方便查阅：</p>
<ul>
<li><p>Flutter 社区<br>  社区主镜像，采用多种方式同步 Flutter 开发者资源（推荐）。</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ export PUB_HOSTED_URL=https://pub.flutter-io.cn</span><br><span class="line">$ export FLUTTER_STORAGE_BASE_URL=https://storage.flutter-io.cn</span><br></pre></td></tr></table></figure>
</li>
<li><p>清华大学 TUNA 协会<br>  定时与 Flutter 社区 Storage 镜像同步，Pub API 采取定时主动抓取策略，镜像配置了完善的失败回源策略（推荐）。</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ export PUB_HOSTED_URL=https://mirrors.tuna.tsinghua.edu.cn/dart-pub</span><br><span class="line">$ export FLUTTER_STORAGE_BASE_URL=https://mirrors.tuna.tsinghua.edu.cn/flutter</span><br></pre></td></tr></table></figure>
</li>
<li><p>上海交大 Linux 用户组<br>  使用反向代理方式建立的 Flutter 镜像，数据与站源实时同步。 Pub API 返回值未做处理，可能造成无法访问的情况。</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ export PUB_HOSTED_URL=https://dart-pub.mirrors.sjtug.sjtu.edu.cn</span><br><span class="line">$ export FLUTTER_STORAGE_BASE_URL=https://mirrors.sjtug.sjtu.edu.cn</span><br></pre></td></tr></table></figure>
</li>
<li><p>CNNIC<br>  基于 TUNA 协会的镜像服务，数据策略与 TUNA 一致，通过非教育网的域名访问。</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ export PUB_HOSTED_URL=http://mirrors.cnnic.cn/dart-pub</span><br><span class="line">$ export FLUTTER_STORAGE_BASE_URL=http://mirrors.cnnic.cn/flutter</span><br></pre></td></tr></table></figure>
</li>
<li><p>腾讯云开源镜像站<br>  定时（每天凌晨）与 TUNA 协会镜像同步，数据有延迟，访问速度有待反馈。</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ export PUB_HOSTED_URL=https://mirrors.cloud.tencent.com/dart-pub</span><br><span class="line">$ export FLUTTER_STORAGE_BASE_URL=https://mirrors.cloud.tencent.com/flutter</span><br></pre></td></tr></table></figure>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
     <a data-url="https://zju.date/flutter-mirrors/" data-id="ckckn9o6l00dirvse8gjipnlh" class="article-share-link">Share</a>
     
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Flutter/">Flutter</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-风寒和风热感冒" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/风寒和风热感冒/" class="article-date">
  <time datetime="2019-11-13T07:42:05.000Z" itemprop="datePublished">2019-11-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/风寒和风热感冒/">风寒与风热感冒</a>
    </h1>
  

      </header>
    



    <div class="article-entry" itemprop="articleBody">
      
        <p>感冒分风寒感冒和风热感冒，这两种感冒病因病机、症状、治疗原则及用药差别很大。风寒感冒是风寒之邪外袭、肺气失宣所致。风热感冒是风热之邪犯表、肺气失和所致。</p>
<ul>
<li><p>风寒感冒症状和疗法</p>
<p>  恶寒重、发热轻、无汗、头痛身痛、鼻塞流清涕、咳嗽吐稀白痰、口不渴或渴喜热饮、苔薄白。治疗药物：风寒感冒颗粒、感冒清热颗粒、正柴胡饮冲剂、头痛严重用川芎茶调散、咳嗽严重用通宣理肺丸。风寒感冒要多喝水、盖好被子、热水泡脚、喝姜茶，发汗有助于康复。</p>
</li>
<li><p>风热感冒症状和疗法</p>
<p>  发热重、微恶风、头胀痛、有汗、咽喉红肿疼痛、咳嗽、痰粘或黄、鼻塞黄涕、口渴喜饮、舌尖边红、苔薄白微黄。治疗药物：感冒灵颗粒、连花清瘟胶囊、柴芩清宁胶囊、维C银翘片、双黄连等。</p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
     <a data-url="https://zju.date/风寒和风热感冒/" data-id="ckckn9ome00z6rvsemmg7dcvu" class="article-share-link">Share</a>
     
    </footer>
  </div>
  
</article>


  
    <article id="post-never-use-flutter-listtile" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/never-use-flutter-listtile/" class="article-date">
  <time datetime="2019-11-12T13:39:02.000Z" itemprop="datePublished">2019-11-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/never-use-flutter-listtile/">千万不要用ListTile组件</a>
    </h1>
  

      </header>
    



    <div class="article-entry" itemprop="articleBody">
      
        <div class="article-preview">
            <p>最初，在 Flutter 项目中用 ListTile 实现了列表项的布局，速度很快，而且代码比较简单，例如：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">ListTile(</span><br><span class="line">  leading: Icon(</span><br><span class="line">    Icons.account_box,</span><br><span class="line">    color: Colors.red,</span><br><span class="line">  ),</span><br><span class="line">  title: Text(</span><br><span class="line">    <span class="string">'账户'</span>,</span><br><span class="line">    textAlign: TextAlign.left,</span><br><span class="line">    style: TextStyle(</span><br><span class="line">      color: Colors.grey,</span><br><span class="line">    ),</span><br><span class="line">  ),</span><br><span class="line">  trailing: Icon(Icons.keyboard_arrow_right),</span><br><span class="line">  onTap: () &#123;</span><br><span class="line">    <span class="comment">// 响应点击事件</span></span><br><span class="line">  &#125;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
        </div>
        
          <p class="article-more-link">
            <a href="/never-use-flutter-listtile/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
     <a data-url="https://zju.date/never-use-flutter-listtile/" data-id="ckckn9ofn00pfrvsedekn7whe" class="article-share-link">Share</a>
     
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Flutter/">Flutter</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-browser-eventloop" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/browser-eventloop/" class="article-date">
  <time datetime="2019-10-31T09:15:09.000Z" itemprop="datePublished">2019-10-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/browser-eventloop/">浏览器中的消息队列和事件循环</a>
    </h1>
  

      </header>
    



    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="事件循环是如何产生的"><a href="#事件循环是如何产生的" class="headerlink" title="事件循环是如何产生的"></a>事件循环是如何产生的</h2><p>在浏览器中，JS 的主线程是单线程的，异步的代码被放到了任务队列中，JS 主线程不断地轮询任务队列，每次从队首取出一个任务并进行处理，从而构成了事件环。</p>
<h2 id="任务队列的类型"><a href="#任务队列的类型" class="headerlink" title="任务队列的类型"></a>任务队列的类型</h2><p>任务队列有两种，分别是宏任务（macrotask）队列和微任务（microtask）队列，用于存放不同的任务：</p>
<ul>
<li>宏任务主要有：script（用户代码）、setTimeout、setInterval、I/O、UI 交互事件、postMessage、MessageChannel 等</li>
<li>微任务主要有：Promise.then、 MutationObserver 等</li>
</ul>
<h2 id="事件环的工作流程"><a href="#事件环的工作流程" class="headerlink" title="事件环的工作流程"></a>事件环的工作流程</h2><ul>
<li>JS 引擎首先从上而下执行用户 script 代码（宏任务）</li>
<li>如果遇到 setTimeout、promise、click事件等，按照分类放入宏任务队列或微任务队列中</li>
<li>继续执行后面的代码，script 执行完毕后，会清空所有的微任务</li>
<li>微任务清空后可能会进行一次 UI 渲染（不是每次都会）</li>
<li>然后再去宏任务队列中取出一个执行，循环往复</li>
</ul>
<h2 id="图示"><a href="#图示" class="headerlink" title="图示"></a>图示</h2><p><img src="http://img.zlib.cn/blog/eventloop.svg?a=1" alt="浏览器中的事件环"></p>
<h2 id="备注"><a href="#备注" class="headerlink" title="备注"></a>备注</h2><p>其实在浏览器中，宏任务队列是可以有多个的，微任务队列只能有一个，上面的图把所有的宏任务都放到一个队列当中并不严谨，但是定时器、事件和 ajax 类型的宏任务是放到一个宏任务队列中的，还有一些其他的宏任务，<a href="https://html.spec.whatwg.org/multipage/webappapis.html#task-queue" target="_blank" rel="noopener">规范</a> 里面的原话是这么说的：</p>
<blockquote>
<p>An event loop has one or more task queues. A task queue is a set of tasks.</p>
</blockquote>
<p>这里<a href="https://blog.risingstack.com/writing-a-javascript-framework-execution-timing-beyond-settimeout" target="_blank" rel="noopener">盗用</a>一张图：</p>
<p><img src="http://img.zlib.cn/blog/task_queues.svg" alt="任务队列"></p>
<p>如果出现多个宏任务队列，应该如何取宏任务呢？这个是比较灵活的，完全交给浏览器自己来实现，规范里面不做限制，但是只要保证下面两点即可：</p>
<ul>
<li>相同来源的宏任务都放到一个宏任务队列中</li>
<li>每个宏任务队列都是按照先进先出的顺序取出</li>
</ul>
<p>规范里面也给出了说明：</p>
<blockquote>
<p>For example, a user agent could have one task queue for mouse and key events (to which the user interaction task source is associated), and another to which all other task sources are associated. Then, using the freedom granted in the initial step of the event loop processing model, it could give keyboard and mouse events preference over other tasks three-quarters of the time, keeping the interface responsive but not starving other task queues. Note that in this setup, the processing model still enforces that the user agent would never process events from any one task source out of order.</p>
</blockquote>
<p>事件循环的逻辑可以用下面的代码来描述：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (eventLoop.waitForTask()) &#123;</span><br><span class="line">  <span class="keyword">const</span> taskQueue = eventLoop.selectTaskQueue() <span class="comment">// 选择宏任务队列</span></span><br><span class="line">  <span class="keyword">if</span> (taskQueue.hasNextTask()) &#123;</span><br><span class="line">    taskQueue.processNextTask() <span class="comment">// 取出宏任务并执行</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> microtaskQueue = eventLoop.microTaskQueue</span><br><span class="line">  <span class="keyword">while</span> (microtaskQueue.hasNextMicrotask()) &#123; <span class="comment">// 清空微任务队列</span></span><br><span class="line">    microtaskQueue.processNextMicrotask()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (shouldRender()) &#123; <span class="comment">// 浏览器决定是否渲染，如果是，则执行下面的逻辑</span></span><br><span class="line">    applyScrollResizeAndCSS()</span><br><span class="line">    runAnimationFrames()</span><br><span class="line">    render()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="https://blog.risingstack.com/writing-a-javascript-framework-execution-timing-beyond-settimeout" target="_blank" rel="noopener">图示</a>如下：</p>
<p><img src="http://img.zlib.cn/blog/browser-event-loop.svg" alt="浏览器中的事件环"></p>

      
    </div>
    <footer class="article-footer">
     <a data-url="https://zju.date/browser-eventloop/" data-id="ckckn9o2c0068rvsec96bamwk" class="article-share-link">Share</a>
     
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-flutter-relative-size" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/flutter-relative-size/" class="article-date">
  <time datetime="2019-10-30T01:52:49.000Z" itemprop="datePublished">2019-10-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/flutter-relative-size/">Flutter设置相对尺寸</a>
    </h1>
  

      </header>
    



    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="相对于屏幕设置尺寸"><a href="#相对于屏幕设置尺寸" class="headerlink" title="相对于屏幕设置尺寸"></a>相对于屏幕设置尺寸</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@override</span></span><br><span class="line">Widget build(BuildContext context) &#123;</span><br><span class="line">  <span class="keyword">return</span> Scaffold(</span><br><span class="line">    appBar: AppBar(</span><br><span class="line">      title: Text(<span class="string">"MediaQuery"</span>),</span><br><span class="line">    ),</span><br><span class="line">    body: Container(</span><br><span class="line">      width: MediaQuery.of(context).size.width * <span class="number">0.5</span>,</span><br><span class="line">      height: MediaQuery.of(context).size.height * <span class="number">0.5</span>,</span><br><span class="line">    ),</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="相对于父组件设置尺寸"><a href="#相对于父组件设置尺寸" class="headerlink" title="相对于父组件设置尺寸"></a>相对于父组件设置尺寸</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@override</span></span><br><span class="line">Widget build(BuildContext context) &#123;</span><br><span class="line">  <span class="keyword">return</span> Scaffold(</span><br><span class="line">    appBar: AppBar(</span><br><span class="line">      title: Text(<span class="string">"FractionallySizedBox"</span>),</span><br><span class="line">    ),</span><br><span class="line">    body: FractionallySizedBox(</span><br><span class="line">      widthFactor: <span class="number">0.5</span>,</span><br><span class="line">      heightFactor: <span class="number">0.5</span>,</span><br><span class="line">      child: Container(</span><br><span class="line">        <span class="comment">// this container won't be larger than</span></span><br><span class="line">        <span class="comment">// half of its parent size</span></span><br><span class="line">      ),</span><br><span class="line">    ),</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="相对于兄弟组件设置尺寸"><a href="#相对于兄弟组件设置尺寸" class="headerlink" title="相对于兄弟组件设置尺寸"></a>相对于兄弟组件设置尺寸</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@override</span></span><br><span class="line">Widget build(BuildContext context) &#123;</span><br><span class="line">  <span class="keyword">return</span> Scaffold(</span><br><span class="line">    appBar: AppBar(</span><br><span class="line">      title: Text(<span class="string">"Expanded"</span>),</span><br><span class="line">    ),</span><br><span class="line">    body: Container(</span><br><span class="line">      child: Row(</span><br><span class="line">        children: &lt;Widget&gt;[</span><br><span class="line">          Expanded(</span><br><span class="line">            flex: <span class="number">6</span>, <span class="comment">// 60% of space =&gt; (6/(6 + 4))</span></span><br><span class="line">            child: Container(</span><br><span class="line">              color: Colors.red,</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">          Expanded(</span><br><span class="line">            flex: <span class="number">4</span>, <span class="comment">// 40% of space</span></span><br><span class="line">            child: Container(</span><br><span class="line">              color: Colors.purple,</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">        ],</span><br><span class="line">      ),</span><br><span class="line">    ),</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
     <a data-url="https://zju.date/flutter-relative-size/" data-id="ckd7jj1z60000ngsevrjua53s" class="article-share-link">Share</a>
     
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Flutter/">Flutter</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/page/3/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/65/">65</a><a class="extend next" rel="next" href="/page/5/">Next &raquo;</a>
  </nav>
</section>

        

      </div>
      <footer id="footer">
  
    <aside id="sidebar" class="outer">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/">Android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Angular/">Angular</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CFA/">CFA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS/">CSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Dart/">Dart</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Database/">Database</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/">Docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ELK/">ELK</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Elasticsearch/">Elasticsearch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Flutter/">Flutter</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/">Git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTML/">HTML</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/">HTTP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mac/">Mac</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MongoDB/">MongoDB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nginx/">Nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/学习笔记/">学习笔记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/小程序/">小程序</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/诗歌/">诗歌</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/随笔/">随笔</a></li></ul>
    </div>
  </div>


  
</aside>
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 zju.date
      &nbsp;&nbsp;&nbsp;
      contact: <a href="mailto:zju.date@qq.com">zju.date@qq.com</a>
    </div>
  </div>
</footer>


    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">主页</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
</nav>
    

<script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>
<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });

</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });

</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });

</script>

<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>