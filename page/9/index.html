<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>zju.date</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content=".">
<meta property="og:url" content="https://zju.date/page/9/index.html">
<meta property="og:site_name" content=".">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content=".">
  
    <link rel="alternate" href="/atom.xml" title="." type="application/atom+xml">
  
  
    <link rel="icon" href="/css/images/banner.jpg">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">.</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">主页</a>
        
          <a class="main-nav-link" href="/archives">归档</a>
        
      </nav>
      <div id="search-form-wrap">
        
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-logstash-multi-input" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/logstash-multi-input/" class="article-date">
  <time datetime="2018-10-21T08:41:56.000Z" itemprop="datePublished">2018-10-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/logstash-multi-input/">logstash 多数据源</a>
    </h1>
  

      </header>
    



    <div class="article-entry" itemprop="articleBody">
      
        <div class="article-preview">
            <p>单个数据源：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">input &#123;</span><br><span class="line">    <span class="comment"># 输入配置</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">filter &#123;</span><br><span class="line">    <span class="comment"># 过滤器逻辑</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">    <span class="comment"># 输出配置</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果有多个数据源，而且给不同的数据源采用不同的 filter 和 output 应该怎么办呢？</p>
        </div>
        
          <p class="article-more-link">
            <a href="/logstash-multi-input/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
     <a data-url="https://zju.date/logstash-multi-input/" data-id="ckckn9obh00ltrvsegv8c495o" class="article-share-link">Share</a>
     
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-curl-with-cookie" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/curl-with-cookie/" class="article-date">
  <time datetime="2018-10-17T03:48:12.000Z" itemprop="datePublished">2018-10-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/curl-with-cookie/">curl 带 cookie</a>
    </h1>
  

      </header>
    



    <div class="article-entry" itemprop="articleBody">
      
        <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -v --cookie <span class="string">"USER_TOKEN=Yes"</span> http://127.0.0.1:5000/</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
     <a data-url="https://zju.date/curl-with-cookie/" data-id="ckckn9o3s008krvseuts5srax" class="article-share-link">Share</a>
     
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/">Linux</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-grid-layout" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/grid-layout/" class="article-date">
  <time datetime="2018-10-10T10:14:12.000Z" itemprop="datePublished">2018-10-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/grid-layout/">CSS网格布局</a>
    </h1>
  

      </header>
    



    <div class="article-entry" itemprop="articleBody">
      
        <div class="article-preview">
            <h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><p>CSS 网格布局已经得到了主流浏览器的支持，相较于传统的布局以及 flex 布局而言，从 <a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_Grid_Layout" target="_blank" rel="noopener">MDN</a> 上可以查到下面几个概念：</p>
<ul>
<li><code>grid container</code>：网格容器，即放置网格项目的容器，定义 <code>display: grid</code> 的 HTML 元素。</li>
<li><code>grid item</code>：网格项目，是网格容器的子节点</li>
<li><code>grid lines</code>：网格线，分隔网格行和列的线</li>
<li><code>grid tracks</code>：网格轨道，相邻网格线之间的空间</li>
<li><code>grid cells</code>：网格单元格，行与列的交集区域</li>
<li><code>grid areas</code>：网格区域，四个网格线组成的矩形区域</li>
</ul>
<p>上面的术语比较抽象，直接看如何定义一个基本的网格容器：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"grid-container"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.grid-container</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: grid; <span class="comment">/* 或者 inline-grid */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        </div>
        
          <p class="article-more-link">
            <a href="/grid-layout/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
     <a data-url="https://zju.date/grid-layout/" data-id="ckckn9o8f00gsrvseqgbxtmc1" class="article-share-link">Share</a>
     
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CSS/">CSS</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-mongodb-stats" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/mongodb-stats/" class="article-date">
  <time datetime="2018-10-05T01:09:23.000Z" itemprop="datePublished">2018-10-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/mongodb-stats/">mongodb stats</a>
    </h1>
  

      </header>
    



    <div class="article-entry" itemprop="articleBody">
      
        <p>查看 MongoDB 的统计数据库信息可以用下面的命令：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">db.stats()</span><br><span class="line">&#123;</span><br><span class="line">        "db" : "test",          # 系统自带测试数据库</span><br><span class="line">        "collections" : 0,      # 集合数量</span><br><span class="line">        "views" : 0,            # </span><br><span class="line">        "objects" : 0,          # 文档对象的个数, 所有集合的记录数之和</span><br><span class="line">        "avgObjSize" : 0,     	# 平均每个对象的大小, 通过 dataSize / Objects 得到</span><br><span class="line">        "dataSize" : 0,         # 当前库所有集合的数据大小</span><br><span class="line">        "storageSize" : 0,   	# 磁盘存储大小</span><br><span class="line">        "numExtents" : 0,		# 所有集合的扩展数据量统计数</span><br><span class="line">        "indexes" : 0,			# 已建立索引数量</span><br><span class="line">        "indexSize" : 0,		# 索引大小</span><br><span class="line">        "fileSize" : 0,			#</span><br><span class="line">        "fsUsedSize" : 0,		#</span><br><span class="line">        "fsTotalSize" : 0,		#</span><br><span class="line">        <span class="string">"ok"</span> : <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中 fsTotalSize 表示 MongoDB 存储数据的文件系统上的所有磁盘容量的总大小，而 fsUsedSize 表示用掉的磁盘空间总大小，默认都是 bytes 单位，不过该函数可接受 scale 参数来切换单位：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.stats(<span class="number">1024</span>) <span class="comment">// 得到的是 k 单位的</span></span><br><span class="line">db.stats(<span class="number">1024</span> * <span class="number">1024</span>) <span class="comment">// 得到的是 M 单位的</span></span><br><span class="line">db.stats(<span class="number">1024</span>*<span class="number">1024</span>*<span class="number">1024</span>) <span class="comment">// 得到 G 为单位 1073741824</span></span><br></pre></td></tr></table></figure>
<p>也可以在指定表上获取统计信息：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users.stats()</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
     <a data-url="https://zju.date/mongodb-stats/" data-id="ckckn9of200ojrvse8viqev9q" class="article-share-link">Share</a>
     
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MongoDB/">MongoDB</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-send-files-using-stream" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/send-files-using-stream/" class="article-date">
  <time datetime="2018-10-05T00:48:12.000Z" itemprop="datePublished">2018-10-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/send-files-using-stream/">服务器用流的方式传输文件</a>
    </h1>
  

      </header>
    



    <div class="article-entry" itemprop="articleBody">
      
        <p>创建一个 nodejs 服务器，用于传输文件给用户，可以用下面的方法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">const</span> server = <span class="built_in">require</span>(<span class="string">'http'</span>).createServer();</span><br><span class="line"></span><br><span class="line">server.on(<span class="string">'request'</span>, (req, res) =&gt; &#123;</span><br><span class="line">  fs.readFile(<span class="string">'./big.file'</span>, (err, data) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">throw</span> err</span><br><span class="line">    res.end(data)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">server.listen(<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>
<p>但是上面的方法有个弊端，就是服务器对内存的占用取决于 big.file 文件的大小，如果文件特别大的话就会导致服务器内存爆仓，更好的方式是采用流：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">const</span> server = <span class="built_in">require</span>(<span class="string">'http'</span>).createServer()</span><br><span class="line"></span><br><span class="line">server.on(<span class="string">'request'</span>, (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> src = fs.createReadStream(<span class="string">'./big.file'</span>)</span><br><span class="line">  src.pipe(res)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
     <a data-url="https://zju.date/send-files-using-stream/" data-id="ckckn9oiw00u9rvse943f3ojp" class="article-share-link">Share</a>
     
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-docker-log-driver" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/docker-log-driver/" class="article-date">
  <time datetime="2018-10-01T23:58:23.000Z" itemprop="datePublished">2018-10-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/docker-log-driver/">docker 日志收集</a>
    </h1>
  

      </header>
    



    <div class="article-entry" itemprop="articleBody">
      
        <div class="article-preview">
            <p>docker 默认的日志驱动是 json-file，即保存在文件中，路径可以通过下面的命令查看：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect --format=<span class="string">'&#123;&#123;.LogPath&#125;&#125;'</span> NAME|ID</span><br></pre></td></tr></table></figure>
<p>例如：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker inspect --format=<span class="string">'&#123;&#123;.LogPath&#125;&#125;'</span> mysql</span><br><span class="line">/var/lib/docker/containers/54571b675a6b52f70aea806977359d8bcd74543cb09e1aa139853113f835d1c4/54571b675a6b52f70aea806977359d8bcd74543cb09e1aa139853113f835d1c4-json.log</span><br></pre></td></tr></table></figure>
<p>json-file 驱动会在启动某个容器时自动创建一个 json 文件，用于存储容器 stdout 与 stderr 输出的内容 ，当在宿主机中运行 <code>docker logs -f 容器名</code> 时，就会读取该文件的内容并显示在终端上。</p>
        </div>
        
          <p class="article-more-link">
            <a href="/docker-log-driver/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
     <a data-url="https://zju.date/docker-log-driver/" data-id="ckckn9o4t00a8rvseq5ahp9vj" class="article-share-link">Share</a>
     
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Docker/">Docker</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-git-rename-and-delete-branch" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/git-rename-and-delete-branch/" class="article-date">
  <time datetime="2018-09-30T06:08:23.000Z" itemprop="datePublished">2018-09-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/git-rename-and-delete-branch/">git 删除和重命名分支</a>
    </h1>
  

      </header>
    



    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>本地分支重命名</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -m old new</span><br></pre></td></tr></table></figure>
<p><strong>删除本地分支</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -D 本地分支名</span><br></pre></td></tr></table></figure>
<p><strong>远程分支重命名</strong></p>
<ul>
<li><p>删除远程分支</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin  :远程分支名(你要删除的远程分支名)</span><br></pre></td></tr></table></figure>
</li>
<li><p>将本地分支推送到远程分支上，如果远程分支不存在，则创建此远程分支</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin  本地分支名:远程分支名</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>如果出现报错：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">error: unable to delete <span class="string">'release/1.2.1'</span>: remote ref does not exist</span><br><span class="line">error: failed to push some refs to <span class="string">'git@xxx:zzz.git'</span></span><br></pre></td></tr></table></figure>
<p>说明其他开发者已经删除了远程分支，但本地 <code>git branch -a</code> 依然显示，用 <code>git fetch -p</code> 即可</p>

      
    </div>
    <footer class="article-footer">
     <a data-url="https://zju.date/git-rename-and-delete-branch/" data-id="ckckn9o7h00f1rvseqdkkp7wy" class="article-share-link">Share</a>
     
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Git/">Git</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-not-a-constructor" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/not-a-constructor/" class="article-date">
  <time datetime="2018-09-30T05:35:07.000Z" itemprop="datePublished">2018-09-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/not-a-constructor/">require 时报错 not a constructor</a>
    </h1>
  

      </header>
    



    <div class="article-entry" itemprop="articleBody">
      
        <div class="article-preview">
            <p>当引用第三方库的时候，经常会遇到下面的错误：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xxx is not a constructor</span><br></pre></td></tr></table></figure>
<p>原因是该第三方库使用 es6 语法暴露出来一个类，但是在项目中使用了 require 来引用导致的。这是 babel 在转换 <code>import</code> 和 <code>export</code> 到 <code>require</code> 和 <code>exports</code> 时存在的差异，举个例子，用 es6 写 processor.js 暴露一个类：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// processor.js</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Processor</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Processor</span><br></pre></td></tr></table></figure>
<p>如果用 require 来引用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// require.js</span></span><br><span class="line"><span class="keyword">const</span> Processor = <span class="built_in">require</span>(<span class="string">'./processor'</span>);</span><br><span class="line"><span class="keyword">const</span> processor = <span class="keyword">new</span> Processor() <span class="comment">// 会报错</span></span><br></pre></td></tr></table></figure>
        </div>
        
          <p class="article-more-link">
            <a href="/not-a-constructor/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
     <a data-url="https://zju.date/not-a-constructor/" data-id="ckckn9ogn00qwrvsexydbi17q" class="article-share-link">Share</a>
     
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-react-keep-alive" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/react-keep-alive/" class="article-date">
  <time datetime="2018-09-28T23:17:31.000Z" itemprop="datePublished">2018-09-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/react-keep-alive/">react保存路由状态</a>
    </h1>
  

      </header>
    



    <div class="article-entry" itemprop="articleBody">
      
        <div class="article-preview">
            <p>在一个 React 项目中，客户希望切换路由再回来的时候，能够保持之前的状态。而保存状态有两种场景：</p>
<ol>
<li>只保留数据状态，不保留交互状态</li>
<li>既保留数据状态，又保留交互状态</li>
</ol>
<p>所谓交互状态，就是连滚动位置、input 框里面输入到一半的文字等状态也要保留。上面两种场景对应的实现方法往往是：</p>
<ol>
<li>状态管理器中保存初始化数据，在 componentDidMount 时调用</li>
<li>把页面隐藏掉，即设置：display: none</li>
</ol>
<p>对于第一种情况，一个简单的实现是把某个页面的状态参数放到 url 的 query 参数里面，同时也在全局状态对象中也存一份，组件初始化的时候先尝试从参数里面加载，如果没有参数，就从全局状态对象中取出来，示例代码如下：</p>
<p>首先在 utils 中写暴露两个函数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getURLState</span>(<span class="params">opts</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; search, history, data = &#123;&#125; &#125; = opts</span><br><span class="line">  <span class="keyword">const</span> params = <span class="keyword">new</span> URLSearchParams(search)</span><br><span class="line">  <span class="keyword">const</span> fields = <span class="built_in">Object</span>.keys(data), ret = &#123;&#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; fields.length; i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> field = fields[i]</span><br><span class="line">    ret[field] = params.get(field) || data[field]</span><br><span class="line">  &#125;</span><br><span class="line">  history.replace(<span class="built_in">window</span>.location.pathname + search)</span><br><span class="line">  <span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">setURLState</span>(<span class="params">opts</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; search, history, data = &#123;&#125; &#125; = opts</span><br><span class="line">  <span class="keyword">const</span> currentUrlParams = <span class="keyword">new</span> URLSearchParams(search)</span><br><span class="line">  <span class="keyword">const</span> fields = <span class="built_in">Object</span>.keys(data), ret = &#123;&#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; fields.length; i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> field = fields[i]</span><br><span class="line">    <span class="keyword">if</span> (field <span class="keyword">in</span> data) currentUrlParams.set(field, data[field])</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> newSearch = <span class="string">'?'</span> + currentUrlParams.toString()</span><br><span class="line">  history.push(<span class="built_in">window</span>.location.pathname + newSearch)</span><br><span class="line">  <span class="keyword">return</span> newSearch</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        </div>
        
          <p class="article-more-link">
            <a href="/react-keep-alive/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
     <a data-url="https://zju.date/react-keep-alive/" data-id="ckckn9oht00sjrvse7jrkidty" class="article-share-link">Share</a>
     
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-sudo-keep-env" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/sudo-keep-env/" class="article-date">
  <time datetime="2018-09-28T01:06:07.000Z" itemprop="datePublished">2018-09-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/sudo-keep-env/">sudo 保持环境变量</a>
    </h1>
  

      </header>
    



    <div class="article-entry" itemprop="articleBody">
      
        <p>sudo 之后环境变量就没了，但有个 <code>-E</code> 选项能够保持环境变量：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ export HTTP_PROXY=foof</span><br><span class="line">$ sudo -E bash -c &apos;echo $HTTP_PROXY&apos;</span><br></pre></td></tr></table></figure>
<p>帮助页面解释如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-E, --preserve-env</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Indicates to the security policy that the user wishes to preserve their existing environment variables.  The security policy may return an error if the user does not have permission to preserve the environment.</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
     <a data-url="https://zju.date/sudo-keep-env/" data-id="ckckn9ojf00v5rvse1m6bf9ju" class="article-share-link">Share</a>
     
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/">Linux</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/page/8/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/page/10/">10</a><a class="page-number" href="/page/11/">11</a><span class="space">&hellip;</span><a class="page-number" href="/page/64/">64</a><a class="extend next" rel="next" href="/page/10/">Next &raquo;</a>
  </nav>
</section>

        

      </div>
      <footer id="footer">
  
    <aside id="sidebar" class="outer">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/">Android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Angular/">Angular</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CFA/">CFA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS/">CSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Dart/">Dart</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Database/">Database</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/">Docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ELK/">ELK</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Elasticsearch/">Elasticsearch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Flutter/">Flutter</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/">Git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTML/">HTML</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/">HTTP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mac/">Mac</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MongoDB/">MongoDB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nginx/">Nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/学习笔记/">学习笔记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/小程序/">小程序</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/诗歌/">诗歌</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/随笔/">随笔</a></li></ul>
    </div>
  </div>


  
</aside>
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 zju.date
      &nbsp;&nbsp;&nbsp;
      contact: <a href="mailto:zju.date@qq.com">zju.date@qq.com</a>
    </div>
  </div>
</footer>


    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">主页</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
</nav>
    

<script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>
<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });

</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });

</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });

</script>

<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>