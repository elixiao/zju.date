<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>zju.date</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="å®‰è£…å®‰è£…æ–¹æ³•ï¼š  Mac  1brew install openresty/brew/openresty  Centos  123yum install yum-utilsyum-config-manager --add-repo https://openresty.org/package/centos/openresty.repoyum install openresty   æ³¨æ„ï¼Œåœ¨ Mac">
<meta name="keywords" content="Nginx">
<meta property="og:type" content="article">
<meta property="og:title" content="openrestyå­¦ä¹ ç¬”è®°">
<meta property="og:url" content="https://zju.date/openresty-notes/index.html">
<meta property="og:site_name" content=".">
<meta property="og:description" content="å®‰è£…å®‰è£…æ–¹æ³•ï¼š  Mac  1brew install openresty/brew/openresty  Centos  123yum install yum-utilsyum-config-manager --add-repo https://openresty.org/package/centos/openresty.repoyum install openresty   æ³¨æ„ï¼Œåœ¨ Mac">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2020-05-11T03:10:20.438Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="openrestyå­¦ä¹ ç¬”è®°">
<meta name="twitter:description" content="å®‰è£…å®‰è£…æ–¹æ³•ï¼š  Mac  1brew install openresty/brew/openresty  Centos  123yum install yum-utilsyum-config-manager --add-repo https://openresty.org/package/centos/openresty.repoyum install openresty   æ³¨æ„ï¼Œåœ¨ Mac">
  
    <link rel="alternate" href="/atom.xml" title="." type="application/atom+xml">
  
  
    <link rel="icon" href="/css/images/banner.jpg">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">.</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">ä¸»é¡µ</a>
        
          <a class="main-nav-link" href="/archives">å½’æ¡£</a>
        
      </nav>
      <div id="search-form-wrap">
        
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-openresty-notes" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/openresty-notes/" class="article-date">
  <time datetime="2019-01-22T03:13:42.000Z" itemprop="datePublished">2019-01-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      openrestyå­¦ä¹ ç¬”è®°
    </h1>
  

      </header>
    



    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>å®‰è£…æ–¹æ³•ï¼š</p>
<ol>
<li><p>Mac</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install openresty/brew/openresty</span><br></pre></td></tr></table></figure>
</li>
<li><p>Centos</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install yum-utils</span><br><span class="line">yum-config-manager --add-repo https://openresty.org/package/centos/openresty.repo</span><br><span class="line">yum install openresty</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>æ³¨æ„ï¼Œåœ¨ Mac ä¸Šå¦‚æœäº‹å…ˆå®‰è£…äº† denjiï¼Œéœ€è¦å…ˆ untapï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew untap denji/nginx</span><br></pre></td></tr></table></figure>
<p>å¦åˆ™ä¼šå‡ºç°ä¸‹é¢çš„é”™è¯¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">TapFormulaAmbiguityError: Formulae found in multiple taps:</span><br><span class="line">       * openresty/brew/openresty-openssl</span><br><span class="line">       * denji/nginx/openresty-openssl</span><br><span class="line"></span><br><span class="line">Please use the fully-qualified name e.g. openresty/brew/openresty-openssl to refer the formula.</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<p>å®‰è£…æˆåŠŸåæç¤ºï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">To have launchd start openresty/brew/openresty now and restart at login:</span><br><span class="line">  brew services start openresty/brew/openresty</span><br><span class="line">Or, <span class="keyword">if</span> you don<span class="string">'t want/need a background service you can just run:</span></span><br><span class="line"><span class="string">  openresty</span></span><br><span class="line"><span class="string">==&gt; Summary</span></span><br><span class="line"><span class="string">ğŸº  /usr/local/Cellar/openresty/1.13.6.2: 293 files, 6.3MB, built in 1 minute 38 seconds</span></span><br></pre></td></tr></table></figure>
<p>è¿›å…¥å®‰è£…åçš„ç›®å½•ï¼ˆMacä¸Šä¸€èˆ¬å®‰è£…åœ¨ <code>/usr/local/Cellar/openresty/1.x.x.x/nginx/sbin</code> ç›®å½•ï¼‰ï¼Œæœ‰å¦‚ä¸‹å­æ–‡ä»¶å¤¹ï¼š</p>
<ul>
<li><code>bin</code>ï¼šå­˜æ”¾å¯æ‰§è¡Œæ–‡ä»¶</li>
<li><code>luajit</code>ï¼šLuaJIT è¿è¡Œåº“</li>
<li><code>lualib</code>ï¼šLua ç»„ä»¶</li>
<li><code>nginx</code>ï¼šNginx æ ¸å¿ƒè¿è¡Œå¹³å°</li>
<li><code>pod</code>ï¼šå‚è€ƒæ‰‹å†Œï¼ˆrestydocï¼‰ä½¿ç”¨çš„æ•°æ®</li>
<li><code>site</code>ï¼šåŒ…ç®¡ç†å·¥å…·ï¼ˆopmï¼‰ä½¿ç”¨çš„æ•°æ®</li>
</ul>
<h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p>å¯åŠ¨å’Œåœæ­¢ openresty æœåŠ¡ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯åŠ¨</span></span><br><span class="line">openresty</span><br><span class="line"><span class="comment"># éªŒè¯æ˜¯å¦è¿è¡Œ</span></span><br><span class="line">curl localhost</span><br><span class="line"><span class="comment"># åœæ­¢</span></span><br><span class="line">openresty -s stop</span><br></pre></td></tr></table></figure>
<p>å¸¸ç”¨å‘½ä»¤ï¼š</p>
<ul>
<li>åå°å¯åŠ¨ï¼š<code>openresty</code></li>
<li>å‰å°å¯åŠ¨ï¼š<code>openresty -g &#39;daemon off;&#39;</code></li>
<li>åœæ­¢ï¼š<code>openresty -s stop</code></li>
<li>é‡å¯ï¼š<code>openresty -s reload</code></li>
<li>æ£€éªŒ nginx é…ç½®æ˜¯å¦æ­£ç¡®ï¼š<code>openresty -t</code></li>
</ul>
<p>æ‰¾ä¸ªç›®å½•ï¼Œæ–°å»ºä¸¤ä¸ªæ–‡ä»¶å¤¹ï¼Œå…¶ä¸­ logs ç›®å½•ç”¨äºå­˜æ”¾æ—¥å¿—ï¼Œconf ç”¨äºå­˜æ”¾é…ç½®æ–‡ä»¶ã€‚</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">worker_processes</span>  <span class="number">1</span>;</span><br><span class="line"><span class="attribute">error_log</span> logs/error.log;</span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">worker_connections</span> <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">9000</span>;</span><br><span class="line">        <span class="attribute">location</span> / &#123;</span><br><span class="line">            <span class="attribute">default_type</span> text/html;</span><br><span class="line">            <span class="attribute">content_by_lua</span> <span class="string">'</span></span><br><span class="line"><span class="string">                ngx.say("&lt;p&gt;Hello, World!&lt;/p&gt;")</span></span><br><span class="line"><span class="string">            '</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŒ‡å®šé…ç½®æ–‡ä»¶è¿è¡Œ</span></span><br><span class="line">openresty -p `<span class="built_in">pwd</span>`/ -c conf/nginx.conf</span><br><span class="line"><span class="comment"># å‰å°è¿è¡Œ</span></span><br><span class="line">openresty -p `<span class="built_in">pwd</span>`/ -c conf/nginx.conf -g <span class="string">'daemon off;'</span></span><br><span class="line"><span class="comment"># éªŒè¯æ‰§è¡Œç»“æœ</span></span><br><span class="line">curl localhost:9000</span><br><span class="line"><span class="comment"># åœæ­¢</span></span><br><span class="line">openresty -p `<span class="built_in">pwd</span>`/ -c conf/nginx.conf -s stop</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ç”¨äº†æŒ‡ä»¤ content_by_luaï¼Œåé¢è·Ÿç€ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå½“ lua ä»£ç æ¯”è¾ƒå¤šçš„æ—¶å€™ï¼Œå°±ä¸åˆé€‚äº†ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥ç”¨ content_by_lua_block æˆ–è€… content_by_lua_file æ¥ç›´æ¥å†™ä»£ç å—æˆ–è€…å¼•ç”¨å¤–éƒ¨ lua æ–‡ä»¶ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    default_type text/html;</span><br><span class="line">    content_by_lua &apos;ngx.say(&quot;&lt;p&gt;Hello, World! content_by_lua&lt;/p&gt;&quot;)&apos;;</span><br><span class="line">    # åœ¨confæ–‡ä»¶é‡Œç›´æ¥å†™ä»£ç å—</span><br><span class="line">    content_by_lua_block &#123;</span><br><span class="line">        ngx.say(&quot;&lt;p&gt;Hello, World!&lt;/p&gt; content_by_lua_block&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">    # å¼•å…¥å¤–éƒ¨luaæ–‡ä»¶ï¼Œè¿™é‡Œæœ€å¥½ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼Œå¦åˆ™å®¹æ˜“å‡ºç°404é”™è¯¯</span><br><span class="line">    # å¦‚æœæ˜¯ç›¸å¯¹è·¯å¾„çš„è¯ï¼Œå‚ç…§ç›®å½•æ˜¯ -p æŒ‡å®šçš„ç›®å½•ï¼Œå¯ä»¥ä½¿ç”¨ openresty -h æŸ¥çœ‹é»˜è®¤ç›®å½•</span><br><span class="line">    content_by_lua_file /lua/hello-world.lua;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="åŒ…ç®¡ç†"><a href="#åŒ…ç®¡ç†" class="headerlink" title="åŒ…ç®¡ç†"></a>åŒ…ç®¡ç†</h3><p>å°±åƒ npm ä¸€æ ·ï¼Œopenresty ä¹Ÿæœ‰ä¸€ä¸ªç»„ä»¶åº“ opmï¼Œåœ°å€æ˜¯ opm.openresty.orgï¼Œå¯ä»¥ä½¿ç”¨ opm å‘½ä»¤æŠŠç»„ä»¶ä¸‹è½½åˆ°æœ¬åœ°è¿›è¡Œç®¡ç†ï¼Œå¸¸ç”¨å‘½ä»¤ä¸ºï¼š</p>
<ul>
<li><code>opm search xxx</code>ï¼šä»¥å…³é”®è¯æ£€ç´¢ç›¸å…³ç»„ä»¶</li>
<li><code>opm get xxx</code>ï¼šå®‰è£…ç»„ä»¶ï¼ˆæ³¨æ„ä¸æ˜¯ installï¼‰</li>
<li><code>opm info xxx</code>ï¼šæ˜¾ç¤ºå·²å®‰è£…ç»„ä»¶çš„è¯¦ç»†ä¿¡æ¯</li>
<li><code>opm remove xxx</code>ï¼šåˆ é™¤ç»„ä»¶</li>
</ul>
<p>åŒ…xxxçš„æ ¼å¼ä¸ºâ€œä½œè€…å/ç»„ä»¶åâ€ï¼Œåœ¨å®‰è£…çš„æ—¶å€™ï¼Œopm é»˜è®¤å®‰è£…åœ¨ <code>site</code> ç›®å½•ä¸‹ï¼Œä½†ç”¨æˆ·å¯ä»¥æŒ‡å®šå®‰è£…è·¯å¾„ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># å®‰è£…åˆ° /opt ç›®å½•</span><br><span class="line">opm --install-dir=/opt get xxx </span><br><span class="line"># å®‰è£…åˆ°å½“å‰ç›®å½•çš„ resty_modules æ–‡ä»¶å¤¹é‡Œé¢</span><br><span class="line">opm --cwd get xxx</span><br></pre></td></tr></table></figure>
<h3 id="å‘½ä»¤è¡Œ"><a href="#å‘½ä»¤è¡Œ" class="headerlink" title="å‘½ä»¤è¡Œ"></a>å‘½ä»¤è¡Œ</h3><p>bin ç›®å½•ä¸‹æœ‰ä¸ª resty å‘½ä»¤æ˜¯ Lua è¯­è¨€çš„è§£é‡Šå™¨ï¼Œè¿è¡Œåœ¨ openresty ç¯å¢ƒä¸‹ï¼Œå·¥ä½œåŸç†æ˜¯å¯åŠ¨äº†ä¸€ä¸ªæ— æœåŠ¡çš„ Nginx å®ä¾‹ï¼Œç¦ç”¨äº† daemon ç­‰å¤§å¤šæ•°æŒ‡ä»¤ï¼Œä¹Ÿæ²¡æœ‰é…ç½®ç›‘å¬ç«¯å£ï¼Œåªæ˜¯åœ¨ worker è¿›ç¨‹é‡Œç”¨å®šæ—¶å™¨è®© Lua ä»£ç åœ¨ Nginx é‡Œæ‰§è¡Œã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">resty -e <span class="string">"print('hello openresty')"</span></span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">æˆ–è€…å†™ä¸€ä¸ªæ–‡ä»¶ï¼š</span><br><span class="line"></span><br><span class="line">```lua</span><br><span class="line"><span class="comment">#!/usr/local/bin/resty</span></span><br><span class="line"><span class="built_in">local</span> n = <span class="comment">#arg</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"args count = "</span>, n)</span><br><span class="line"><span class="keyword">for</span> i = 1,n <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"arg "</span>, i, <span class="string">":"</span>, arg[i])</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„ä»£ç æŠŠå‚æ•°é€ä¸€æ‰“å°å‡ºæ¥ï¼Œè¿è¡Œæ•ˆæœå¦‚ä¸‹ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ resty test.lua a b c d</span><br><span class="line">args count = 4</span><br><span class="line">arg 1:a</span><br><span class="line">arg 2:b</span><br><span class="line">arg 3:c</span><br><span class="line">arg 4:d</span><br></pre></td></tr></table></figure>
<h2 id="Nginx-åŸºç¡€çŸ¥è¯†"><a href="#Nginx-åŸºç¡€çŸ¥è¯†" class="headerlink" title="Nginx åŸºç¡€çŸ¥è¯†"></a>Nginx åŸºç¡€çŸ¥è¯†</h2><h4 id="http-æœåŠ¡åŸºæœ¬è¯­æ³•ï¼š"><a href="#http-æœåŠ¡åŸºæœ¬è¯­æ³•ï¼š" class="headerlink" title="http æœåŠ¡åŸºæœ¬è¯­æ³•ï¼š"></a>http æœåŠ¡åŸºæœ¬è¯­æ³•ï¼š</h4><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">        server_name: name;</span><br><span class="line">        <span class="attribute">location</span> uri &#123;</span><br><span class="line">        </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li><p>server é…ç½®ï¼š</p>
<ul>
<li>port ç«¯å£å·</li>
<li>server_name ä¸ HTTP è¯·æ±‚å¤´çš„ Host å­—æ®µè¿›è¡ŒåŒ¹é…</li>
</ul>
</li>
<li><p>location é…ç½®</p>
<p> location [=|~|~*|^~] uri {}</p>
<ul>
<li><code>=</code> å®Œå…¨åŒ¹é…</li>
<li><code>~</code> å¤§å°å†™æ•æ„ŸåŒ¹é…</li>
<li><code>~*</code> å¤§å°å†™ä¸æ•æ„ŸåŒ¹é…</li>
<li><p><code>^~</code> å‰ç¼€åŒ¹é…</p>
<p>location åœ¨ server å—é‡Œé¢çš„é¡ºåºæ— å…³ç´§è¦ï¼Œå› ä¸º Nginx ä¼šå¯¹æ‰€æœ‰å¯èƒ½çš„åŒ¹é…è¿›è¡Œæ’åºï¼ŒæŸ¥æ‰¾æœ€ä½³åŒ¹é…ã€‚</p>
</li>
</ul>
</li>
</ol>
<h4 id="TCP-UDP-æœåŠ¡åŸºæœ¬è¯­æ³•ï¼š"><a href="#TCP-UDP-æœåŠ¡åŸºæœ¬è¯­æ³•ï¼š" class="headerlink" title="TCP/UDP æœåŠ¡åŸºæœ¬è¯­æ³•ï¼š"></a>TCP/UDP æœåŠ¡åŸºæœ¬è¯­æ³•ï¼š</h4><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">stream</span> &#123;</span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">100</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="åå‘ä»£ç†"><a href="#åå‘ä»£ç†" class="headerlink" title="åå‘ä»£ç†"></a>åå‘ä»£ç†</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    proxy_pass http://nginx-xxx;</span><br><span class="line">    proxy_http_version 1.1;</span><br><span class="line">    proxy_set_header Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">    proxy_set_header Connection <span class="string">"upgrade"</span>;</span><br><span class="line">    proxy_set_header Host <span class="variable">$host</span>;</span><br><span class="line">    proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">    proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="ä¸Šæ¸¸é›†ç¾¤"><a href="#ä¸Šæ¸¸é›†ç¾¤" class="headerlink" title="ä¸Šæ¸¸é›†ç¾¤"></a>ä¸Šæ¸¸é›†ç¾¤</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    server xxx:xx;</span><br><span class="line">    server xxx:xx weight=3;</span><br><span class="line">    server xxx:xx backup;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="æ—¥å¿—"><a href="#æ—¥å¿—" class="headerlink" title="æ—¥å¿—"></a>æ—¥å¿—</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰è®¿é—®æ—¥å¿—æ ¼å¼</span></span><br><span class="line">log_format name format_string;</span><br><span class="line"><span class="comment"># æ—¥å¿—å­˜å‚¨ä½ç½®</span></span><br><span class="line">access_log path;</span><br><span class="line"><span class="comment"># é”™è¯¯æ—¥å¿—ä½ç½®(ä¸èƒ½è‡ªå®šä¹‰æ ¼å¼)</span></span><br><span class="line">error_log path level;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬åœ¨ content_by_lua é‡Œé¢å†™äº†</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ngx.log(ngx.ERR, &quot;error&quot;)</span><br><span class="line">ngx.log(ngx.INFO, &quot;info&quot;)</span><br><span class="line">print([[i am print]])</span><br></pre></td></tr></table></figure>
<p>å‘ç°åªæœ‰ error åœ¨ error.log ä¸­è¢«æ‰“å°å‡ºæ¥äº†ï¼Œ info å’Œ print éƒ½æ¶ˆå¤±äº†ï¼Œå…¶å®å°±æ˜¯ level çš„è®¾ç½®é—®é¢˜ï¼Œå¦‚æœè®¾ç½®æˆ debugï¼Œé‚£ä¹ˆæ‰€æœ‰æ—¥å¿—å°±éƒ½ä¼šå‡ºç°äº†ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error_log /data/error.log [error_level];</span><br></pre></td></tr></table></figure>
<p>å¸¸è§çš„é”™è¯¯æ—¥å¿—çº§åˆ«ä»ä½åˆ°é«˜æ˜¯ debugã€infoã€noticeã€warnã€errorã€critã€alertã€emergï¼Œçº§åˆ«è¶Šé«˜è®°å½•çš„ä¿¡æ¯è¶Šå°‘ï¼Œé‚£äº›å¤§äºç­‰äºè®¾ç½®ç­‰çº§çš„æ—¥å¿—å‡ä¼šè¢«è®°å½•ã€‚ç”Ÿäº§åœºæ™¯ä¸€èˆ¬ç”¨ warn | error | crit è¿™ä¸‰ä¸ªçº§åˆ«ä¹‹ä¸€ï¼Œå°½é‡ä¸è¦é…ç½® info ç­‰çº§è¾ƒä½çš„çº§åˆ«ï¼Œå› ä¸ºè¿™æ ·ä¼šå¸¦æ¥å¤§é‡çš„ç£ç›˜I/Oæ¶ˆè€—ã€‚è¿™äº›çº§åˆ«å¯¹åº”çš„ ngx è¾“å‡ºå‡½æ•°åˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li><code>ngx.STDERR</code>ï¼šæ ‡å‡†è¾“å‡º</li>
<li><code>ngx.EMERG</code>ï¼šç´§æ€¥æŠ¥é”™</li>
<li><code>ngx.ALERT</code>ï¼šæŠ¥è­¦</li>
<li><code>ngx.CRIT</code>ï¼šä¸¥é‡ï¼Œç³»ç»Ÿæ•…éšœï¼Œ è§¦å‘è¿ç»´å‘Šè­¦ç³»ç»Ÿ</li>
<li><code>ngx.ERR</code>ï¼šé”™è¯¯ï¼Œä¸šåŠ¡ä¸å¯æ¢å¤æ€§é”™è¯¯</li>
<li><code>ngx.WARN</code>ï¼šæé†’ï¼Œä¸šåŠ¡ä¸­å¯å¿½ç•¥é”™è¯¯</li>
<li><code>ngx.NOTICE</code>ï¼šæé†’ï¼Œä¸šåŠ¡ä¸­æ¯”è¾ƒé‡è¦ä¿¡æ¯</li>
<li><code>ngx.INFO</code>ï¼šä¿¡æ¯ï¼Œä¸šåŠ¡çç¢æ—¥å¿—ä¿¡æ¯ï¼Œ åŒ…å«ä¸åŒæƒ…å†µåˆ¤æ–­ç­‰</li>
<li><code>ngx.DEBUG</code>ï¼šè°ƒè¯•</li>
</ul>
<p>å¦‚æœæƒ³æ‰“å°åœ¨ access.log ä¸­å‘¢ï¼Ÿå¯ä»¥ç”¨ä¸‹é¢çš„åŠæ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    log_format main &apos;[$time_local] $request $status $remote_addr $define_error_code&apos;;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        location / &#123;</span><br><span class="line">            set $define_error_code &apos;&apos;;</span><br><span class="line">            content_by_lua_block &#123;</span><br><span class="line">                ngx.var.define_error_code = 9527</span><br><span class="line">                ngx.say(&quot;hello world&quot;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        access_log logs/access.log main;</span><br><span class="line">        error_log logs/error.log;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>errlog è®°å½•æ—¥å¿—æ—¶æ˜¯ç›´æ¥å†™ç£ç›˜çš„é˜»å¡æ“ä½œï¼Œæ²¡æœ‰ç¼“å†²ç­‰ä¼˜åŒ–æªæ–½ï¼Œæ‰€ä»¥ä»…åº”è¯¥ç”¨æ¥è®°å½•å¿…è¦çš„é”™è¯¯ä¿¡æ¯å’Œè°ƒè¯•ï¼Œä¸åº”è¯¥åœ¨å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸­é¢‘ç¹åœ°è°ƒç”¨æ­¤æ¥å£å†™ç£ç›˜æ–‡ä»¶ï¼Œå¦åˆ™ä¼šæå¤§åœ°æ‹–ç´¯ OpenRestyï¼Œä¸è¿‡å¯ä»¥ç”¨ lua-resty-logger-socket éé˜»å¡çš„è®°å½•æ—¥å¿—ï¼Œå³ä»¥éé˜»å¡ IO æ–¹å¼æ¨é€ access log åˆ°è¿œç¨‹æœåŠ¡å™¨ä¸Šã€‚å¯¹è¿œç¨‹æœåŠ¡å™¨çš„è¦æ±‚æ˜¯æ”¯æŒ syslog-ng çš„æ—¥å¿—æœåŠ¡ã€‚ç¤ºä¾‹ï¼š</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">log_by_lua_block &#123;</span><br><span class="line">    <span class="keyword">local</span> logger = <span class="built_in">require</span> <span class="string">"resty.logger.socket"</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> logger.initted() <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">local</span> ok, err = logger.init&#123;</span><br><span class="line">            host = <span class="string">'xxx'</span>,</span><br><span class="line">            port = <span class="number">1234</span>,</span><br><span class="line">            flush_limit = <span class="number">1234</span>,</span><br><span class="line">            drop_limit = <span class="number">5678</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> ok <span class="keyword">then</span></span><br><span class="line">            ngx.<span class="built_in">log</span>(ngx.ERR, <span class="string">'failed to initialize the logger: '</span>, err)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">local</span> bytes, err = logger.<span class="built_in">log</span>(msg)</span><br><span class="line">    <span class="keyword">if</span> err <span class="keyword">then</span></span><br><span class="line">        ngx.<span class="built_in">log</span>(ngx.ERR, <span class="string">'failed to log message: '</span>, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h2 id="Lua-è¯­è¨€æ¦‚è¿°"><a href="#Lua-è¯­è¨€æ¦‚è¿°" class="headerlink" title="Lua è¯­è¨€æ¦‚è¿°"></a>Lua è¯­è¨€æ¦‚è¿°</h2><h2 id="LuaJIT"><a href="#LuaJIT" class="headerlink" title="LuaJIT"></a>LuaJIT</h2><p>LuaJIT æ˜¯ Lua è¯­è¨€çš„çš„éå®˜æ–¹å®ç°ï¼ŒåŒ…æ‹¬ä¸€ä¸ªæ±‡ç¼–è¯­è¨€ç¼–å†™çš„è§£é‡Šå™¨å’Œä¸€ä¸ª JIT ç¼–è¯‘å™¨ï¼Œæ¯”å®˜æ–¹è§£é‡Šå™¨å¿«å¾ˆå¤šã€‚</p>
<p>openresty æ ¸å¿ƒç»„ä»¶</p>
<ol>
<li>Nginx</li>
<li>LuaJIT</li>
<li>ngx_lua(http_lua)</li>
<li>stream_lua</li>
</ol>
<p>ä¸€äº›åº”ç”¨åœºæ™¯ï¼šç°åº¦å‘å¸ƒã€é™æµã€å‚æ•°å®‰å…¨æ ¡éªŒã€apiç½‘å…³</p>
<h2 id="LuaRocks"><a href="#LuaRocks" class="headerlink" title="LuaRocks"></a>LuaRocks</h2><p>LuaRocks æ˜¯ lua çš„åŒ…ç®¡ç†å™¨ï¼Œä¸‹è½½åœ°å€ <a href="https://github.com/luarocks/luarocks/wiki/Downloadï¼Œå¦‚æœæ˜¯" target="_blank" rel="noopener">https://github.com/luarocks/luarocks/wiki/Downloadï¼Œå¦‚æœæ˜¯</a> Mac å¯ä»¥ç›´æ¥ç”¨ brew å®‰è£…ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install luarocks</span><br></pre></td></tr></table></figure>
<p>luarocks å¯ä»¥å¾ˆæ–¹ä¾¿çš„æŸ¥æ‰¾å’Œå®‰è£…ç¬¬ä¸‰æ–¹ Lua æ¨¡å—ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">luarocks search json <span class="comment"># æŸ¥æ‰¾jsonæ¨¡å—</span></span><br><span class="line">luarocks install lua-mongo <span class="comment"># å®‰è£…mongodbæ¨¡å—</span></span><br><span class="line">luarocks install redis-lua <span class="comment"># å®‰è£…redisæ¨¡å—</span></span><br><span class="line">luarocks install lua-cjson <span class="comment"># å®‰è£…jsonæ¨¡å—</span></span><br><span class="line">luarocks list  <span class="comment"># æŸ¥çœ‹å·²ç»å®‰è£…çš„æ¨¡å—</span></span><br><span class="line">luarocks remove json4lua <span class="comment"># å¸è½½æ¨¡å—</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœè¢«æŸ¥æ‰¾çš„æ¨¡å—æœ‰å¾ˆå¤šçš„è¯ï¼Œå‘½ä»¤è¡Œè¾“å‡ºä¸ç›´è§‚ï¼Œä¹Ÿä¸çŸ¥é“å“ªä¸ªå¥½å“ªä¸ªåï¼Œæ­¤æ—¶å¯ä»¥å»å®˜ç½‘æŸ¥æ‰¾ï¼š<a href="http://luarocks.org/ï¼Œé‡Œé¢æœ‰æ¯ä¸ªæ¨¡å—çš„ä½œè€…ã€ä¸‹è½½æ¬¡æ•°ã€ä¸Šæ¬¡æ›´æ–°æ—¶é—´ç­‰ï¼Œä¸€ç›®äº†ç„¶ã€‚ä¸‹é¢å°±å»æ‰¾ä¸€ä¸ª" target="_blank" rel="noopener">http://luarocks.org/ï¼Œé‡Œé¢æœ‰æ¯ä¸ªæ¨¡å—çš„ä½œè€…ã€ä¸‹è½½æ¬¡æ•°ã€ä¸Šæ¬¡æ›´æ–°æ—¶é—´ç­‰ï¼Œä¸€ç›®äº†ç„¶ã€‚ä¸‹é¢å°±å»æ‰¾ä¸€ä¸ª</a> json æ¨¡å—ç”¨äºè§£æ jsonï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">luarocks install lua-cjson</span><br><span class="line">Installing https://luarocks.org/lua-cjson-2.1.0.6-1.src.rock</span><br><span class="line"></span><br><span class="line">env MACOSX_DEPLOYMENT_TARGET=10.8 gcc -O2 -fPIC -I/usr/<span class="built_in">local</span>/opt/lua/include/lua5.3 -c lua_cjson.c -o lua_cjson.o</span><br><span class="line">lua_cjson.c:743:19: warning: implicit declaration of <span class="keyword">function</span> <span class="string">'lua_objlen'</span> is invalid <span class="keyword">in</span> C99</span><br><span class="line">      [-Wimplicit-function-declaration]</span><br><span class="line">            len = lua_objlen(l, -1);</span><br><span class="line">                  ^</span><br><span class="line">1 warning generated.</span><br><span class="line">env MACOSX_DEPLOYMENT_TARGET=10.8 gcc -O2 -fPIC -I/usr/<span class="built_in">local</span>/opt/lua/include/lua5.3 -c strbuf.c -o strbuf.o</span><br><span class="line">env MACOSX_DEPLOYMENT_TARGET=10.8 gcc -O2 -fPIC -I/usr/<span class="built_in">local</span>/opt/lua/include/lua5.3 -c fpconv.c -o fpconv.o</span><br><span class="line">env MACOSX_DEPLOYMENT_TARGET=10.8 gcc -bundle -undefined dynamic_lookup -all_load -o cjson.so lua_cjson.o strbuf.o fpconv.o</span><br><span class="line">lua-cjson 2.1.0.6-1 is now installed <span class="keyword">in</span> /usr/<span class="built_in">local</span> (license: MIT)</span><br></pre></td></tr></table></figure>
<p>ç„¶ååˆ†åˆ«å†™ä¸€ä¸ª test.json æ–‡ä»¶å’Œ test.lua æ–‡ä»¶ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"hello"</span>: <span class="string">"lua"</span>&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FileRead</span><span class="params">()</span></span></span><br><span class="line">  <span class="keyword">local</span> file = <span class="built_in">io</span>.<span class="built_in">open</span>(<span class="string">"test.json"</span>,<span class="string">"r"</span>)</span><br><span class="line">  <span class="keyword">local</span> json = file:<span class="built_in">read</span>(<span class="string">"*a"</span>);</span><br><span class="line">  file:<span class="built_in">close</span>()</span><br><span class="line">  <span class="keyword">return</span> json</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">local</span> cjson = <span class="built_in">require</span> <span class="string">"cjson"</span></span><br><span class="line"><span class="keyword">local</span> file = FileRead()</span><br><span class="line"><span class="keyword">local</span> json = cjson.decode(file)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i,w <span class="keyword">in</span> <span class="built_in">ipairs</span>(json.configs) <span class="keyword">do</span></span><br><span class="line">  <span class="built_in">print</span>(<span class="string">"user:"</span>..w.user)</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">"password:"</span>..w.password)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"str:"</span>..json.str)</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œå‘ç°æŠ¥é”™äº†ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ lua test.lua</span><br><span class="line">lua: error loading module <span class="string">'cjson'</span> from file <span class="string">'./test.lua'</span>:</span><br><span class="line">        ./test.lua:2: too many C levels (<span class="built_in">limit</span> is 200) <span class="keyword">in</span> <span class="keyword">function</span> at line 1 near <span class="string">'"test.json"'</span></span><br><span class="line">stack traceback:</span><br><span class="line">        [C]: <span class="keyword">in</span> ?</span><br><span class="line">        [C]: <span class="keyword">in</span> <span class="keyword">function</span> <span class="string">'require'</span></span><br><span class="line">        ./test.lua:7: <span class="keyword">in</span> main chunk</span><br></pre></td></tr></table></figure>
<p>çœ‹é”™è¯¯ä¿¡æ¯å¯ä»¥å®šä½åˆ° require å‡½æ•°å‡ºäº†é—®é¢˜ã€‚require å‡½æ•°æ˜¯ç”¨æ¥åŠ è½½æ¨¡å—çš„ï¼Œè€Œè¦åŠ è½½ä¸€ä¸ªæ¨¡å—ï¼Œå°±å¿…é¡»çš„çŸ¥é“è¿™ä¸ªæ¨¡å—åœ¨å“ªé‡Œï¼Œåªæœ‰çŸ¥é“äº†è¿™ä¸ªæ¨¡å—åœ¨å“ªé‡Œä»¥åï¼Œæ‰èƒ½è¿›è¡Œæ­£ç¡®çš„åŠ è½½ã€‚<code>require xxx</code> æ˜¯å¦‚ä½•æ‰¾ xxx æ¨¡å—çš„å‘¢ï¼Ÿå…¶å®æ˜¯å» <code>LUA_PATH</code> ç¯å¢ƒå˜é‡ä¸­æ‰¾ã€‚require ä¼šç”¨æ¨¡å—åæ¥æ›¿æ¢æ¯ä¸ªé—®å· ?ï¼Œç„¶åæ ¹æ®æ›¿æ¢çš„ç»“æœæ¥æ£€æŸ¥æ˜¯å¦å­˜åœ¨è¿™æ ·ä¸€ä¸ªæ–‡ä»¶ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œå°±ä¼šå°è¯•ä¸‹ä¸€é¡¹ã€‚è·¯å¾„ä¸­çš„æ¯ä¸€é¡¹éƒ½æ˜¯ä»¥åˆ†å·éš”å¼€ï¼Œæ¯”å¦‚è·¯å¾„ä¸ºä»¥ä¸‹å­—ç¬¦ä¸²ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?;?.lua;c:\windows\?;/usr/<span class="built_in">local</span>/lua/?/?.lua</span><br></pre></td></tr></table></figure>
<p>å½“æˆ‘ä»¬ <code>require xxx</code> æ—¶ï¼Œå°±ä¼šå°è¯•ç€æ‰“å¼€ä»¥ä¸‹æ–‡ä»¶ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">xxx</span><br><span class="line">xxx.lua</span><br><span class="line">c:\windows\xxx</span><br><span class="line">/usr/<span class="built_in">local</span>/lua/xxx/xxx.lua</span><br></pre></td></tr></table></figure>
<p>require å‡½æ•°åªå¤„ç†äº†åˆ†å·å’Œé—®å·ï¼Œå…¶å®ƒçš„éƒ½æ˜¯ç”±è·¯å¾„è‡ªå·±å®šä¹‰çš„ã€‚åœ¨å®é™…ç¼–ç¨‹ä¸­ï¼Œrequire ç”¨äºæœç´¢çš„ Lua æ–‡ä»¶çš„è·¯å¾„å­˜æ”¾åœ¨å˜é‡ <code>package.path</code> ä¸­ï¼Œå¯ä»¥ç”¨ <code>print(package.path)</code> è¾“å‡ºå…¨éƒ¨è·¯å¾„ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/<span class="built_in">local</span>/share/lua/5.3/?.lua;/usr/<span class="built_in">local</span>/share/lua/5.3/?/init.lua;/usr/<span class="built_in">local</span>/lib/lua/5.3/?.lua;/usr/<span class="built_in">local</span>/lib/lua/5.3/?/init.lua;./?.lua;./?/init.lua</span><br></pre></td></tr></table></figure>
<p>å¦‚æœ require æ— æ³•æ‰¾åˆ°ä¸æ¨¡å—åç›¸ç¬¦çš„ Lua æ–‡ä»¶ï¼Œé‚£ Lua å°±ä¼šå¼€å§‹æ‰¾ C ç¨‹åºåº“ï¼›è¿™ä¸ªçš„æœç´¢åœ°å€ä¸º <code>package.cpath</code> å¯¹åº”çš„åœ°å€ï¼Œç”¨ <code>print(package.cpath)</code> ä¼šè¾“å‡ºå…¨éƒ¨è·¯å¾„ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/lib/lua/5.3/?.so;/usr/local/lib/lua/5.3/loadall.so;./?.so</span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥ <code>lua_package_path</code> å’Œ <code>lua_package_cpath</code> è¿™ä¸¤ä¸ªç¯å¢ƒå˜é‡å¾ˆé‡è¦ï¼Œåœ¨ OpenResty ä¸­ï¼Œè¿™ä¸¤ä¸ªæŒ‡ä»¤æ—¶è¿è¡Œ OpenResty åº”ç”¨çš„å…³é”®ï¼Œå®ƒä»¬ä»¥å­—ç¬¦ä¸²çš„å½¢å¼ç¡®å®š Lua åº“å’Œ so åº“çš„æŸ¥æ‰¾è·¯å¾„ï¼Œæ–‡ä»¶åä½¿ç”¨ â€œ?â€ ä½œä¸ºé€šé…ç¬¦ï¼Œå¤šä¸ªè·¯å¾„ä½¿ç”¨ â€œ;â€ åˆ†éš”ï¼Œé»˜è®¤çš„æŸ¥æ‰¾è·¯å¾„ç”¨ â€œ;;â€ã€‚ä¾‹å¦‚åœ¨ nginx ä¸­</p>
<p>æŒ‡ä»¤é‡Œè¿˜å¯ä»¥ä½¿ç”¨ç‰¹æ®Šå˜é‡ â€œ$prefixâ€ï¼Œè¡¨ç¤º OpenResty å¯åŠ¨æ—¶çš„å·¥ä½œç›®å½•ï¼ˆå³ â€œ-pâ€ å‚æ•°æŒ‡å®šçš„ç›®å½•ï¼‰ï¼Œè¿™æ ·å°±å¯ä»¥ä¸ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼Œé…ç½®æ›´åŠ çµæ´»ã€‚ä¾‹å¦‚åœ¨ nginx é…ç½®ä¸­å¯ä»¥è¿™ä¹ˆå†™ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    access_log logs/access.log;</span><br><span class="line">    lua_package_path <span class="string">"<span class="variable">$prefix</span>/lua_modules/share/lua/5.1/?.lua;;"</span>;</span><br><span class="line">    lua_package_cpath <span class="string">"<span class="variable">$prefix</span>/lua_modules/lib/lua/5.1/?.so;;"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„æŒ‡ä»¤å‘Šè¯‰ OpenResty åœ¨å·¥ä½œç›®å½•çš„ lua_modules é‡ŒæŸ¥æ‰¾ Lua åº“å’Œ *.so åº“ã€‚æˆ‘ä»¬ä¸éœ€è¦åœ¨æŒ‡ä»¤é‡Œé¢å¤–æŒ‡å®š OpenResty çš„å®‰è£…ç›®å½•ï¼Œè¿™æ˜¯å› ä¸ºåœ¨å®‰è£…æ—¶ OpenResty å·²ç»é»˜è®¤å†…ç½®äº†è‡ªå·±çš„æŸ¥æ‰¾ç›®å½•ï¼Œå³ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/usr/<span class="built_in">local</span>/openresty/lualib/?.lua</span><br><span class="line">/usr/<span class="built_in">local</span>/openresty/site/lualib/?.lua</span><br><span class="line">/usr/<span class="built_in">local</span>/openresty/lualib/?.so</span><br><span class="line">/usr/<span class="built_in">local</span>/openresty/site/lualib/?.so</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œå°¤å…¶éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼ŒæŸ¥æ‰¾ä¼šé¦–å…ˆä»å½“å‰ç›®å½•ä¸‹æŸ¥æ‰¾ï¼Œå¦‚æœä½ å¼•ç”¨äº† cjsonï¼Œç„¶è€Œä½ æœ‰ç»™è¿™ä¸ªæ–‡ä»¶èµ·åå« cjson.lua è€Œä¸æ˜¯ test.luaï¼Œå°±ä¼šæŠ¥é”™ï¼Œæˆ‘åœ¨è¿™é‡Œå‘äº†å¾ˆä¹…â€¦ï¼Œæ”¹å› test.lua å°±å¥½äº†ã€‚æ›´å¤–ï¼Œå¦‚æœå‡ºç°ä¸‹é¢çš„æŠ¥é”™ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">lua: error loading module <span class="string">'cjson'</span> from file <span class="string">'/usr/local/lib/lua/5.3/cjson.so'</span>:</span><br><span class="line">        dlopen(/usr/<span class="built_in">local</span>/lib/lua/5.3/cjson.so, 6): Symbol not found: _lua_objlen</span><br><span class="line">  Referenced from: /usr/<span class="built_in">local</span>/lib/lua/5.3/cjson.so</span><br><span class="line">  Expected <span class="keyword">in</span>: flat namespace</span><br><span class="line"> <span class="keyword">in</span> /usr/<span class="built_in">local</span>/lib/lua/5.3/cjson.so</span><br><span class="line">stack traceback:</span><br><span class="line">        [C]: <span class="keyword">in</span> ?</span><br><span class="line">        [C]: <span class="keyword">in</span> <span class="keyword">function</span> <span class="string">'require'</span></span><br><span class="line">        test.lua:7: <span class="keyword">in</span> main chunk</span><br><span class="line">        [C]: <span class="keyword">in</span> ?</span><br></pre></td></tr></table></figure>
<p>æ˜¯å› ä¸º <code>2.1.0.6-1</code> è¿™ä¸ªç‰ˆæœ¬çš„æœ‰äº›é—®é¢˜ï¼Œå¯ä»¥çœ‹åˆ° cjson è¢«å®‰è£…åˆ° <code>/usr/local/lib/luarocks/rocks-5.3/lua-cjson/2.1.0.6-1</code> ä¸‹é¢ï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„æ–¹æ³•æŒ‡å®šç‰ˆæœ¬ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ luarocks remove lua-cjson</span><br><span class="line">$ luarocks install lua-cjson 2.1.0-1</span><br></pre></td></tr></table></figure>
<p>åœ¨ Mac ä¸Šå®‰è£… luarocks ä¹‹åï¼Œå‘ç°è¢«æˆ‘å®‰è£…äº†ä¸¤ä¸ªç‰ˆæœ¬çš„luaï¼Œ5.1 å’Œ 5.3ï¼Œè¿™ä¸¤ä¸ªç‰ˆæœ¬è¯­æ³•ä¸å…¼å®¹ï¼Œè€Œ OpenResty ä½¿ç”¨çš„æ˜¯ luajit ç¼–è¯‘å™¨ï¼Œè€Œ luajit ç¼–è¯‘å™¨ä»…æ”¯æŒ 5.1 ç‰ˆæœ¬çš„ luaï¼Œå¹¶ä¸æ”¯æŒ 5.3 ç‰ˆæœ¬çš„ã€‚è¿™å°±ä¼šå¸¦æ¥ä¸€äº›é—®é¢˜ï¼Œä¾‹å¦‚ç”¨ luarocks å®‰è£…ä¹‹åä¾èµ–è¢«æ”¾åœ¨äº† <code>/usr/local/lib/lua/5.3</code> ç›®å½•ä¸‹ï¼Œä½†æ˜¯ require çš„æ—¶å€™ OpenResty ä¼šä» <code>/usr/local/lib/lua/5.1</code> ä¸­æŸ¥æ‰¾ï¼ŒæŸ¥ä¸åˆ°å°±ä¼šæŠ¥é”™ã€‚å¥½åœ¨å¯ä»¥å®‰è£…ä¾èµ–çš„æ—¶å€™æŒ‡å®š lua çš„ç‰ˆæœ¬ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯ 5.3ï¼Œä½†æ˜¯å¦‚æœæƒ³ç”¨ 5.1 å°±ä½¿ç”¨ <code>--lua-dir</code> æˆ– <code>--lua-version</code> é€‰é¡¹ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">luarocks --lua-dir=$(brew --prefix)/opt/lua@5.1 install say</span><br><span class="line">luarocks --lua-dir=/usr/<span class="built_in">local</span>/opt/lua@5.1 install lua-mongo </span><br><span class="line">luarocks --lua-version 5.1 install lua-mongo </span><br><span class="line">luarocks --lua-version 5.1 install redis-lua</span><br><span class="line">luarocks --lua-version 5.1 install lua-resty-url</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·ä¾èµ–ä¼šè¢«å®‰è£…åˆ°ä¸‹é¢çš„ç›®å½•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/Users/xxx/.luarocks/lib/lua/5.1</span><br></pre></td></tr></table></figure>
<p>luarocks å®‰è£…ä¾èµ–æ”¯æŒä¸‰ç§å­˜å‚¨ä½ç½®ï¼š</p>
<ul>
<li>å…¨å±€Globalï¼ˆé»˜è®¤ï¼‰ï¼šå®‰è£…åœ¨ç³»ç»Ÿçº§çš„ä½ç½®ï¼Œä¾‹å¦‚ /usr/share/lua/5.1</li>
<li>æœ¬åœ°Localï¼šç”¨æˆ· home ç›®å½•ï¼Œç”¨ <code>--local</code> æŒ‡å®š</li>
<li>è‡ªå®šä¹‰Customï¼šå¯ä»¥ä»»æ„æŒ‡å®šå®‰è£…ç›®å½•ï¼Œç”¨ <code>--tree some/directory</code></li>
</ul>
<p>æ›´å¥½çš„æ–¹å¼æ˜¯è‡ªå®šä¹‰å®‰è£…ä½ç½®ï¼Œæˆ‘å–œæ¬¢æŠŠå®ƒå®‰è£…åˆ°å½“å‰ç›®å½•çš„ lua_modules ç›®å½•ä¸‹ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">luarocks --lua-version 5.1 install --tree lua_modules redis-lua</span><br><span class="line">luarocks --lua-version 5.1 install --tree lua_modules lua-mongo</span><br><span class="line">luarocks --lua-version 5.1 install --tree lua_modules lua-resty-url</span><br><span class="line">luarocks --lua-version 5.1 install --tree lua_modules lua-resty-http</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ—¶å€™é…ç½® path å’Œ cpath çš„ä½ç½®å°±æ˜¯ï¼š</p>
<ul>
<li>path : <code>lua_modules/share/lua/5.1/?.lua</code></li>
<li>cpath: <code>lua_modules/lib/lua/5.1/?.so</code></li>
</ul>
<h2 id="Lua-è¿æ¥-Redisã€MongoDB-ç­‰ç¤ºä¾‹"><a href="#Lua-è¿æ¥-Redisã€MongoDB-ç­‰ç¤ºä¾‹" class="headerlink" title="Lua è¿æ¥ Redisã€MongoDB ç­‰ç¤ºä¾‹"></a>Lua è¿æ¥ Redisã€MongoDB ç­‰ç¤ºä¾‹</h2><h3 id="Lua-è¿æ¥-Redis"><a href="#Lua-è¿æ¥-Redis" class="headerlink" title="Lua è¿æ¥ Redis"></a>Lua è¿æ¥ Redis</h3><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> redis = <span class="built_in">require</span> <span class="string">'redis'</span></span><br><span class="line"><span class="keyword">local</span> client = redis.connect(<span class="string">'127.0.0.1'</span>, <span class="number">6379</span>)</span><br><span class="line"><span class="keyword">local</span> response = client:ping()    </span><br><span class="line"><span class="built_in">print</span>(response)</span><br><span class="line"></span><br><span class="line">client:set(<span class="string">'usr:nrk'</span>, <span class="number">10</span>)</span><br><span class="line">client:set(<span class="string">'usr:nobody'</span>, <span class="number">5</span>)</span><br><span class="line"><span class="keyword">local</span> value = client:get(<span class="string">'usr:nrk'</span>)</span><br><span class="line"><span class="built_in">print</span>(value)</span><br></pre></td></tr></table></figure>
<p>æ›´å¤šçš„ç¤ºä¾‹åœ¨ <a href="https://github.com/nrk/redis-lua" target="_blank" rel="noopener">redis-luaå®˜æ–¹ä»“åº“</a> é‡Œé¢</p>
<h3 id="Lua-è¿æ¥-MongoDB"><a href="#Lua-è¿æ¥-MongoDB" class="headerlink" title="Lua è¿æ¥ MongoDB"></a>Lua è¿æ¥ MongoDB</h3><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> mongo = <span class="built_in">require</span> <span class="string">'mongo'</span></span><br><span class="line"><span class="keyword">local</span> client = mongo.Client <span class="string">'mongodb://username:password@mongodb-uri:27017/databaseName'</span></span><br><span class="line"><span class="keyword">local</span> collection = client:getCollection(<span class="string">'databaseName'</span>, <span class="string">'collectionName'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- countæŸ¥è¯¢æ€»æ•°</span></span><br><span class="line"><span class="built_in">print</span>(collection:count(&#123;&#125;, &#123;&#125;))</span><br><span class="line"><span class="comment">-- findOne</span></span><br><span class="line"><span class="built_in">print</span>(collection:findOne(&#123;&#125;))</span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> id = mongo.ObjectID()</span><br><span class="line"><span class="keyword">local</span> query = mongo.BSON &#123; _id = id &#125;</span><br><span class="line"><span class="built_in">print</span>(collection:findOne(query))</span><br></pre></td></tr></table></figure>
<p>æ›´å¤šçš„ç¤ºä¾‹åœ¨ <a href="https://github.com/neoxic/lua-mongo/blob/master/test" target="_blank" rel="noopener">lua-mongoå®˜æ–¹ä»“åº“</a> é‡Œé¢ï¼Œä¸€ä¸ªå…¸å‹çš„åº”ç”¨åœºæ™¯æ˜¯ç”¨ lua å°†ç½‘é¡µä¸Šæ”¶é›†åˆ°ç”¨æˆ·æ“ä½œè¡Œä¸ºé€šè¿‡ OpenResty å†™å…¥ mongodb ä¸­ï¼Œä½†æ˜¯ lua ç›´æ¥æ“ä½œmongodb æœ‰å¾ˆå¤šç¼ºé™·ï¼Œä¾‹å¦‚æ¯æ¬¡å†™å…¥éƒ½è¦è·å–ä¸€ä¸ªè¿æ¥å®ä¾‹ï¼Œå¼€å¯ä¸€ä¸ªè¿æ¥ï¼Œè€Œç½‘é¡µä¸Šçš„è¡Œä¸ºæ”¶é›†æ˜¯ä¸€ä¸ªé«˜å¹¶å‘çš„ï¼Œä¼šå ç”¨å¾ˆå¤šèµ„æºã€‚ä¸è¿‡ç½‘ä¸Šæœ‰ä¸€äº›æ¡ˆä¾‹ï¼Œå¯ä»¥ç”¨æ•°æ®åº“è¿æ¥æ± æ¥ä¼˜åŒ–è¿™ä¸ªé—®é¢˜ï¼Œæ„Ÿå…´è¶£çš„è¯å¯ä»¥æœæœçœ‹ã€‚</p>
<h2 id="åœ¨-docker-ä¸­ä½¿ç”¨-openresty-é•œåƒ"><a href="#åœ¨-docker-ä¸­ä½¿ç”¨-openresty-é•œåƒ" class="headerlink" title="åœ¨ docker ä¸­ä½¿ç”¨ openresty é•œåƒ"></a>åœ¨ docker ä¸­ä½¿ç”¨ openresty é•œåƒ</h2><p>[å®˜æ–¹ä»“åº“][<a href="https://github.com/openresty/docker-openresty]" target="_blank" rel="noopener">https://github.com/openresty/docker-openresty]</a> é‡Œé¢æœ‰å¾ˆå¤šé•œåƒï¼Œä¾‹å¦‚ï¼š </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker pull openresty/openresty <span class="comment"># é»˜è®¤é•œåƒ</span></span><br><span class="line">docker pull openresty/openresty:alpine <span class="comment"># æŒ‡å®š alpine é•œåƒ</span></span><br><span class="line">docker pull openresty/openresty:1.15.8.3-alpine <span class="comment"># æŒ‡å®š openresty çš„ç‰ˆæœ¬</span></span><br><span class="line">docker pull openresty/openresty:centos <span class="comment"># Centos é•œåƒ</span></span><br><span class="line">docker pull openresty/openresty:xenial <span class="comment"># Ubuntu é•œåƒ</span></span><br><span class="line">docker pull openresty/openresty:alpine-fat <span class="comment"># èƒ– alpine é•œåƒ</span></span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­é»˜è®¤çš„é•œåƒæ˜¯åŸºäº Debian çš„ï¼Œä½“ç§¯ç›¸å¯¹è¾ƒå°ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openresty/openresty    latest           3c5b5f6743d4        2 weeks ago         84.8MB</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢ä¸‰ä¸ªé•œåƒæ˜¯è‡ªå¸¦ luarocks çš„ï¼Œå¯ä»¥çœ‹åˆ°é•œåƒéƒ½æ¯”è¾ƒå¤§äº†ï¼Œå…¶ä¸­æœ€å°çš„ centos ä¹Ÿè¦280Mï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openresty/openresty    xenial           382416af27a3        2 weeks ago         551MB</span><br><span class="line">openresty/openresty    centos           a5fc4f8038a3        2 weeks ago         280MB</span><br><span class="line">openresty/openresty    alpine-fat       eef3ac05ac87        2 weeks ago         321MB</span><br></pre></td></tr></table></figure>
<p>åœ¨è‡ªå¸¦ luarocks çš„å®¹å™¨å†…éƒ¨å¯ä»¥ç›´æ¥å®‰è£…ç¬¬ä¸‰æ–¹åº“ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">luarocks install lua-resty-url</span><br><span class="line">Installing https://luarocks.org/lua-resty-url-0.3.5-1.src.rock</span><br><span class="line"></span><br><span class="line">No existing manifest. Attempting to rebuild...</span><br><span class="line">lua-resty-url 0.3.5-1 is now installed <span class="keyword">in</span> /usr/<span class="built_in">local</span>/openresty/luajit (license: Apache License 2.0)</span><br></pre></td></tr></table></figure>
<p>é»˜è®¤çš„å®‰è£…ä½ç½®æ˜¯ï¼š</p>
<ul>
<li>path: <code>/usr/local/openresty/luajit/lib/luarocks/rocks-5.1/?.lua</code></li>
<li>cpathï¼š<code>/usr/local/openresty/luajit/lib/lua/5.1/?.so</code></li>
</ul>
<p>å®¹å™¨å†… nginx çš„é…ç½®è·¯å¾„åœ¨ <code>/usr/local/openresty/nginx/conf</code></p>

      
    </div>
    <footer class="article-footer">
     <a data-url="https://zju.date/openresty-notes/" data-id="ckckn9ogq00r2rvsejkj9zuot" class="article-share-link">Share</a>
     
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Nginx/">Nginx</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/gulp-in-deep/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          gulp å­¦ä¹ ç¬”è®°
        
      </div>
    </a>
  
  
    <a href="/angular-video-autoPlay/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Angular ä¸­ video è‡ªåŠ¨é™éŸ³æ’­æ”¾</div>
    </a>
  
</nav>

  
</article>

</section>

        

      </div>
      <footer id="footer">
  
    <aside id="sidebar" class="outer">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/">Android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Angular/">Angular</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CFA/">CFA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS/">CSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Dart/">Dart</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Database/">Database</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/">Docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ELK/">ELK</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Elasticsearch/">Elasticsearch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Flutter/">Flutter</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/">Git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTML/">HTML</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/">HTTP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mac/">Mac</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MongoDB/">MongoDB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nginx/">Nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/å­¦ä¹ ç¬”è®°/">å­¦ä¹ ç¬”è®°</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/å°ç¨‹åº/">å°ç¨‹åº</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/è¯—æ­Œ/">è¯—æ­Œ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/éšç¬”/">éšç¬”</a></li></ul>
    </div>
  </div>


  
</aside>
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 zju.date
      &nbsp;&nbsp;&nbsp;
      contact: <a href="mailto:zju.date@qq.com">zju.date@qq.com</a>
    </div>
  </div>
</footer>


    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">ä¸»é¡µ</a>
  
    <a href="/archives" class="mobile-nav-link">å½’æ¡£</a>
  
</nav>
    

<script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>
<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });

</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });

</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });

</script>

<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>